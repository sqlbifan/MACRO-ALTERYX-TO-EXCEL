{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "spacing": 2,
  "autosize": {"type": "fit-y", "contains": "padding"},
  "config": {
    "title": {
      "font": "Segoe UI",
      "fontSize": 16,
      "fontWeight": "bold"
    }
  },

  "params": [
    {"name": "barheight","value": 30},
    {"name": "TextSize","value": 15},
    {"name": "TextSize2","value": 13}
  ],

  "data": {"name": "dataset"},

  /* דירוג לפי ACTUAL */
  "transform": [
    {
      "window": [
        {"op": "rank", "as": "sort_order"}
      ],
      "sort": [
        {"field": "ACTUAL", "order": "descending"}
      ]
    }
  ],

  "hconcat": [
    /* --------- LEFT --------- */
    {
      "title": {
        "text": "מרווח",
        "anchor": "middle",
        "color": "#B3B3B3",
        "font": "Segoe UI",
        "fontWeight": "bold",
        "subtitle": null
      },
      "transform": [
        {"calculate": "-datum.ACTUAL_2", "as": "NEG_ACTUAL_2"},
        {"calculate": "-datum.plan_2", "as": "NEG_plan_2"},
        {"calculate": "datum.ACTUAL_vs_TARGET_2", "as": "AVT2"},
        {
          "joinaggregate": [
            {"op": "max", "field": "ACTUAL_2", "as": "MaxActual2"},
            {"op": "max", "field": "plan_2", "as": "MaxPlan2"}
          ]
        },
        {
