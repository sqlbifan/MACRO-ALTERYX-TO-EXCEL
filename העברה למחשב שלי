{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"name": "dataset"},
  "width": 240,
  "height": 60,
  "transform": [
    {"calculate": "100", "as": "_background_width"},
    {"calculate": "10", "as": "_circle_padding"},
    {
      "calculate": "datum['SORT FIELD'] == 'ACTUAL' ? datum['_circle_padding'] : datum['_background_width'] - datum['_circle_padding']",
      "as": "_circle_position"
    },
    {
      "calculate": "datum['SORT FIELD'] == 'ACTUAL' ? 'right' : 'left'",
      "as": "_label_align"
    },
    {"calculate": "10", "as": "_label_padding"},
    {
      "calculate": "datum['SORT FIELD'] == 'ACTUAL' ? datum['_background_width'] - datum['_label_padding'] : datum['_label_padding']",
      "as": "_label_position"
    }
  ],
  "layer": [
    {
      // רקע
      "mark": {
        "type": "bar",
        "height": 35,
        "cornerRadius": 20,
        "fill": {"expr": "pbiColor(1)"},
        "stroke": "#000",
        "y": 30
      },
      "encoding": {
        "x": {"field": "_background_width", "type": "quantitative", "axis": null}
      }
    },
    {
      // העיגול
      "mark": {
        "type": "circle",
        "size": {"expr": "PI * pow(18, 2)"},
        "color": "white",
        "y": 30
      },
      "encoding": {
        "x": {"field": "_circle_position", "type": "quantitative"}
      }
    },
    {
      // האייקון במרכז
      "mark": {"type": "image", "width": 40, "height": 40, "y": 30},
      "encoding": {
        "x": {"field": "_circle_position", "type": "quantitative"},
        "url": {"field": "ICON"}
      }
    },
    {
      // כיתוב
      "mark": {
        "type": "text",
        "align": {"expr": "datum['_label_align']"},
        "fontSize": 16,
        "fontWeight": "bold",
        "color": "white",
        "y": 30
      },
      "encoding": {
        "text": {"field": "DISC", "type": "nominal"},
        "x": {"field": "_label_position", "type": "quantitative"}
      }
    }
  ]
}
